---
layout: pr
date: 2023-03-29
title: "Ephemeral Anchors"
pr: 26403
authors: [instagibbs]
components: ["tx fees and policy", "mempool"]
host: instagibbbs
status: upcoming
commit: 
---

## Notes

### Background

Please review [V3 and Package RBF Part 1](https://bitcoincore.reviews/25038) and [Part 2](https://bitcoincore.reviews/25038-2) for background info on the problem setting and proposed solution for RBF pinning.

The proposed Ephemeral Anchor BIP is hosted [here](https://github.com/instagibbs/bips/blob/ephemeral_anchor/bip-ephemeralanchors.mediawiki).

There is also a [bitcoin-inquisition PR](https://github.com/bitcoin-inquisition/bitcoin/pull/23).

### Motivation

**Version 3** transactions solve the issue with what is commonly dubbed [BIP125 rule#3](https://github.com/bitcoin/bips/blob/master/bip-0125.mediawiki) pinning: A large, low fee-rate transaction enters the mempool, and becomes economically prohibitive to remove from the mempool via today's RBF rules. By limiting the size of a child transaction in a parent-child relationship to 1 KvB, we can bound this economic damage to a small multiple which depends upon what an "honest" CPFP'ing child transaction would look like given a users' wallet utxo makeup. In essence, it is a "RBF carveout" policy.

**Ephemeral anchors** are a special type of output that are watermarked (by policy only) via a short static output script. These, along with a few policy ground rules, enable a new, more general "CPFP Carveout" which can sidestep *package limit pinning*. It also allows relaxation of output script requirements, increasing smart contract composability.

Lighting Network [BOLT03](https://github.com/lightning/bolts/blob/master/03-transactions.md#commitment-transaction-outputs) for some "light" reading about how to avoid package limit pinning(poorly) with today's mempool policies. See `option_anchors` scripts, with `1 OP_CHECKSEQUENCEVERIFY OP_DROP` as the canonical widget to avoid pinning.

## Questions

1. Did you review the PR? [Concept ACK, approach ACK, tested ACK, or NACK](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#peer-review)? What was your review approach?

1. Why do anti-pinning measures in [BOLT03](https://github.com/lightning/bolts/blob/master/03-transactions.md#commitment-transaction-outputs) appear suboptimal?

1. What is today's [CPFP carve-out](https://bitcoinops.org/en/topics/cpfp-carve-out/) in Bitcoin Core? What are its limitations?

1. In what ways could BOLT03 be improved with Ephemeral Anchors?

1. What use cases are helped by including an ephemeral anchor? What use cases is it not helpful for?

1. Why does the usage of ephemeral anchors rely on package relay?

1. What mechanisms do we have in place to discourage dust level utxos?

1. Are 0-value outputs consensus valid to create? How about in policy? (Hint: see standardness checks for [vout](https://github.com/bitcoin/bitcoin/blob/e352f5ab6b60ec1cc549997275e945238508cdee/src/policy/policy.cpp#L133-L148)).

1. Are 0-value outputs consensus valid to spend? How about in policy?

1. Does this increase the risk of dust entering the utxo set? Can you think of any situations that might arise?

1. Why does this new output type use `OP_TRUE`?

1. What benefits does this PR get from requiring V3 transactions? What properties of V3 does it rely on, if any?

1. Why are non-0 value outputs allowed to be Ephemeral Anchors?

1. Why not just watermark ephemeral anchors by being a dust output?

1. What is the [bitcoin-inquisition](https://github.com/bitcoin-inquisition/bitcoin/pull/23) PR doing differently? Why?

<!--
## Meeting Log
{% irc %}
{% endirc %}
-->
